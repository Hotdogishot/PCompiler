(function(f){"object"==typeof exports&&"object"==typeof module?f(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],f):f(CodeMirror)})(function(f){function A(a){this.options=a;this.from=this.to=0}function r(a,b){for(var d=a.findMarks(h(b,0),h(b+1,0)),c=0;c<d.length;++c)if(d[c].__isFold){var g=d[c].find(-1);if(g&&g.line===b)return d[c]}}function t(a){if("string"==typeof a){var b=document.createElement("div");b.className=
a+" CodeMirror-guttermarker-subtle";return b}return a.cloneNode(!0)}function k(a,b,d){var c=a.state.foldGutter.options,g=b-1,B=a.foldOption(c,"minFoldSize"),u=a.foldOption(c,"rangeFinder"),v="string"==typeof c.indicatorFolded&&new RegExp("(^|\\s)"+c.indicatorFolded+"(?:$|\\s)\\s*"),w="string"==typeof c.indicatorOpen&&new RegExp("(^|\\s)"+c.indicatorOpen+"(?:$|\\s)\\s*");a.eachLine(b,d,function(x){++g;var l=null,e=x.gutterMarkers;e&&(e=e[c.gutter]);if(r(a,g)){if(v&&e&&v.test(e.className))return;l=
t(c.indicatorFolded)}else{var m=h(g,0);if((m=u&&u(a,m))&&m.to.line-m.from.line>=B){if(w&&e&&w.test(e.className))return;l=t(c.indicatorOpen)}}(l||e)&&a.setGutterMarker(x,c.gutter,l)})}function q(a){var b=a.getViewport(),d=a.state.foldGutter;d&&(a.operation(function(){k(a,b.from,b.to)}),d.from=b.from,d.to=b.to)}function y(a,b,d){var c=a.state.foldGutter;c&&(c=c.options,d==c.gutter&&((d=r(a,b))?d.clear():a.foldCode(h(b,0),c)))}function n(a){var b=a.state.foldGutter;if(b){var d=b.options;b.from=b.to=
0;clearTimeout(b.changeUpdate);b.changeUpdate=setTimeout(function(){q(a)},d.foldOnChangeTimeSpan||600)}}function z(a){var b=a.state.foldGutter;if(b){var d=b.options;clearTimeout(b.changeUpdate);b.changeUpdate=setTimeout(function(){var c=a.getViewport();b.from==b.to||20<c.from-b.to||20<b.from-c.to?q(a):a.operation(function(){c.from<b.from&&(k(a,c.from,b.from),b.from=c.from);c.to>b.to&&(k(a,b.to,c.to),b.to=c.to)})},d.updateViewportTimeSpan||400)}}function p(a,b){var d=a.state.foldGutter;if(d){var c=
b.line;c>=d.from&&c<d.to&&k(a,c,c+1)}}f.defineOption("foldGutter",!1,function(a,b,d){d&&d!=f.Init&&(a.clearGutter(a.state.foldGutter.options.gutter),a.state.foldGutter=null,a.off("gutterClick",y),a.off("changes",n),a.off("viewportChange",z),a.off("fold",p),a.off("unfold",p),a.off("swapDoc",n));b&&(d=a.state,!0===b&&(b={}),null==b.gutter&&(b.gutter="CodeMirror-foldgutter"),null==b.indicatorOpen&&(b.indicatorOpen="CodeMirror-foldgutter-open"),null==b.indicatorFolded&&(b.indicatorFolded="CodeMirror-foldgutter-folded"),
d.foldGutter=new A(b),q(a),a.on("gutterClick",y),a.on("changes",n),a.on("viewportChange",z),a.on("fold",p),a.on("unfold",p),a.on("swapDoc",n))});var h=f.Pos});