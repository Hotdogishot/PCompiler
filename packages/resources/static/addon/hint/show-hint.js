(function(h){"object"==typeof exports&&"object"==typeof module?h(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],h):h(CodeMirror)})(function(h){function B(a,b){this.cm=a;this.options=b;this.widget=null;this.tick=this.debounce=0;this.startPos=this.cm.getCursor("start");this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;if(this.options.updateOnCursorActivity){var c=this;a.on("cursorActivity",this.activityFunc=
function(){c.cursorActivity()})}}function J(a,b){function c(r,g){var p="string"!=typeof g?function(l){return g(l,b)}:d.hasOwnProperty(g)?d[g]:g;m[r]=p}var d={Up:function(){b.moveFocus(-1)},Down:function(){b.moveFocus(1)},PageUp:function(){b.moveFocus(-b.menuSize()+1,!0)},PageDown:function(){b.moveFocus(b.menuSize()-1,!0)},Home:function(){b.setFocus(0)},End:function(){b.setFocus(b.length-1)},Enter:b.pick,Tab:b.pick,Esc:b.close};/Mac/.test(navigator.platform)&&(d["Ctrl-P"]=function(){b.moveFocus(-1)},
d["Ctrl-N"]=function(){b.moveFocus(1)});var e=a.options.customKeys,m=e?{}:d;if(e)for(var f in e)e.hasOwnProperty(f)&&c(f,e[f]);if(e=a.options.extraKeys)for(f in e)e.hasOwnProperty(f)&&c(f,e[f]);return m}function C(a,b){for(;b&&b!=a;){if("LI"===b.nodeName.toUpperCase()&&b.parentNode==a)return b;b=b.parentNode}}function D(a,b){this.completion=a;this.data=b;this.picked=!1;var c=this,d=a.cm,e=d.getInputField().ownerDocument,m=e.defaultView||e.parentWindow,f=this.hints=e.createElement("ul");f.className=
"CodeMirror-hints "+a.cm.options.theme;this.selectedHint=b.selectedHint||0;for(var r=b.list,g=0;g<r.length;++g){var p=f.appendChild(e.createElement("li")),l=r[g],k="CodeMirror-hint"+(g!=this.selectedHint?"":" CodeMirror-hint-active");null!=l.className&&(k=l.className+" "+k);p.className=k;l.render?l.render(p,b,l):p.appendChild(e.createTextNode(l.displayText||("string"==typeof l?l:l.text)));p.hintId=g}k=a.options.container||e.body;g=d.cursorCoords(a.options.alignWithWord?b.from:null);var t=g.left,u=
g.bottom,E=!0,q=p=0;if(k!==e.body){l=-1!==["absolute","relative","fixed"].indexOf(m.getComputedStyle(k).position)?k:k.offsetParent;var v=l.getBoundingClientRect();q=e.body.getBoundingClientRect();p=v.left-q.left-l.scrollLeft;q=v.top-q.top-l.scrollTop}f.style.left=t-p+"px";f.style.top=u-q+"px";l=m.innerWidth||Math.max(e.body.offsetWidth,e.documentElement.offsetWidth);var x=m.innerHeight||Math.max(e.body.offsetHeight,e.documentElement.offsetHeight);k.appendChild(f);k=a.options.moveOnOverlap?f.getBoundingClientRect():
new DOMRect;v=a.options.paddingForScrollbar?f.scrollHeight>f.clientHeight+1:!1;var y;setTimeout(function(){y=d.getScrollInfo()});if(0<k.bottom-x){var z=k.bottom-k.top;0<g.top-(g.bottom-k.top)-z?(f.style.top=(u=g.top-z-q)+"px",E=!1):z>x&&(f.style.height=x-5+"px",f.style.top=(u=g.bottom-k.top-q)+"px",q=d.getCursor(),b.from.ch!=q.ch&&(g=d.cursorCoords(q),f.style.left=(t=g.left-p)+"px",k=f.getBoundingClientRect()))}q=k.right-l;0<q&&(k.right-k.left>l&&(f.style.width=l-5+"px",q-=k.right-k.left-l),f.style.left=
(t=g.left-q-p)+"px");if(v)for(g=f.firstChild;g;g=g.nextSibling)g.style.paddingRight=d.display.nativeBarWidth+"px";d.addKeyMap(this.keyMap=J(a,{moveFocus:function(n,w){c.changeActive(c.selectedHint+n,w)},setFocus:function(n){c.changeActive(n)},menuSize:function(){return c.screenAmount()},length:r.length,close:function(){a.close()},pick:function(){c.pick()},data:b}));if(a.options.closeOnUnfocus){var F;d.on("blur",this.onBlur=function(){F=setTimeout(function(){a.close()},100)});d.on("focus",this.onFocus=
function(){clearTimeout(F)})}d.on("scroll",this.onScroll=function(){var n=d.getScrollInfo(),w=d.getWrapperElement().getBoundingClientRect(),G=u+y.top-n.top,A=G-(m.pageYOffset||(e.documentElement||e.body).scrollTop);E||(A+=f.offsetHeight);if(A<=w.top||A>=w.bottom)return a.close();f.style.top=G+"px";f.style.left=t+y.left-n.left+"px"});h.on(f,"dblclick",function(n){(n=C(f,n.target||n.srcElement))&&null!=n.hintId&&(c.changeActive(n.hintId),c.pick())});h.on(f,"click",function(n){(n=C(f,n.target||n.srcElement))&&
null!=n.hintId&&(c.changeActive(n.hintId),a.options.completeOnSingleClick&&c.pick())});h.on(f,"mousedown",function(){setTimeout(function(){d.focus()},20)});g=this.getSelectedHintRange();0===g.from&&0===g.to||this.scrollToActive();h.signal(b,"select",r[this.selectedHint],f.childNodes[this.selectedHint]);return!0}function K(a,b){if(!a.somethingSelected())return b;for(var c=[],d=0;d<b.length;d++)b[d].supportsSelection&&c.push(b[d]);return c}function H(a,b,c,d){a.async?a(b,d,c):(a=a(b,c))&&a.then?a.then(d):
d(a)}h.showHint=function(a,b,c){if(!b)return a.showHint(c);c&&c.async&&(b.async=!0);b={hint:b};if(c)for(var d in c)b[d]=c[d];return a.showHint(b)};h.defineExtension("showHint",function(a){var b=this.getCursor("start"),c=this.options.hintOptions,d={},e;for(e in I)d[e]=I[e];if(c)for(e in c)void 0!==c[e]&&(d[e]=c[e]);if(a)for(e in a)void 0!==a[e]&&(d[e]=a[e]);d.hint.resolve&&(d.hint=d.hint.resolve(this,b));a=d;b=this.listSelections();if(!(1<b.length)){if(this.somethingSelected()){if(!a.hint.supportsSelection)return;
for(e=0;e<b.length;e++)if(b[e].head.line!=b[e].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();b=this.state.completionActive=new B(this,a);b.options.hint&&(h.signal(this,"startCompletion",this),b.update(!0))}});h.defineExtension("closeHint",function(){this.state.completionActive&&this.state.completionActive.close()});var L=window.requestAnimationFrame||function(a){return setTimeout(a,1E3/60)},M=window.cancelAnimationFrame||clearTimeout;B.prototype={close:function(){this.active()&&
(this.tick=this.cm.state.completionActive=null,this.options.updateOnCursorActivity&&this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&h.signal(this.data,"close"),this.widget&&this.widget.close(),h.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(a,b){var c=a.list[b],d=this;this.cm.operation(function(){c.hint?c.hint(d.cm,a,c):d.cm.replaceRange("string"==typeof c?c:c.text,c.from||a.from,c.to||a.to,"complete");
h.signal(a,"pick",c);d.cm.scrollIntoView()});this.options.closeOnPick&&this.close()},cursorActivity:function(){this.debounce&&(M(this.debounce),this.debounce=0);var a=this.startPos;this.data&&(a=this.data.from);var b=this.cm.getCursor(),c=this.cm.getLine(b.line);if(b.line!=this.startPos.line||c.length-b.ch!=this.startLen-this.startPos.ch||b.ch<a.ch||this.cm.somethingSelected()||!b.ch||this.options.closeCharacters.test(c.charAt(b.ch-1)))this.close();else{var d=this;this.debounce=L(function(){d.update()});
this.widget&&this.widget.disable()}},update:function(a){if(null!=this.tick){var b=this,c=++this.tick;H(this.options.hint,this.cm,this.options,function(d){b.tick==c&&b.finishUpdate(d,a)})}},finishUpdate:function(a,b){this.data&&h.signal(this.data,"update");var c=this.widget&&this.widget.picked||b&&this.options.completeSingle;this.widget&&this.widget.close();(this.data=a)&&a.list.length&&(c&&1==a.list.length?this.pick(a,0):(this.widget=new D(this,a),h.signal(a,"shown")))}};D.prototype={close:function(){if(this.completion.widget==
this){this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var a=this.completion.cm;this.completion.options.closeOnUnfocus&&(a.off("blur",this.onBlur),a.off("focus",this.onFocus));a.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var a=this;this.keyMap={Enter:function(){a.picked=!0}};this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},
changeActive:function(a,b){a>=this.data.list.length?a=b?this.data.list.length-1:0:0>a&&(a=b?0:this.data.list.length-1);if(this.selectedHint!=a){var c=this.hints.childNodes[this.selectedHint];c&&(c.className=c.className.replace(" CodeMirror-hint-active",""));c=this.hints.childNodes[this.selectedHint=a];c.className+=" CodeMirror-hint-active";this.scrollToActive();h.signal(this.data,"select",this.data.list[this.selectedHint],c)}},scrollToActive:function(){var a=this.getSelectedHintRange(),b=this.hints.childNodes[a.from];
a=this.hints.childNodes[a.to];var c=this.hints.firstChild;b.offsetTop<this.hints.scrollTop?this.hints.scrollTop=b.offsetTop-c.offsetTop:a.offsetTop+a.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=a.offsetTop+a.offsetHeight-this.hints.clientHeight+c.offsetTop)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1},getSelectedHintRange:function(){var a=this.completion.options.scrollMargin||0;return{from:Math.max(0,
this.selectedHint-a),to:Math.min(this.data.list.length-1,this.selectedHint+a)}}};h.registerHelper("hint","auto",{resolve:function(a,b){var c=a.getHelpers(b,"hint"),d;if(c.length){var e=function(m,f,r){function g(l){if(l==p.length)return f(null);H(p[l],m,r,function(k){k&&0<k.list.length?f(k):g(l+1)})}var p=K(m,c);g(0)};e.async=!0;e.supportsSelection=!0;return e}return(d=a.getHelper(a.getCursor(),"hintWords"))?function(m){return h.hint.fromList(m,{words:d})}:h.hint.anyword?function(m,f){return h.hint.anyword(m,
f)}:function(){}}});h.registerHelper("hint","fromList",function(a,b){var c=a.getCursor(),d=a.getTokenAt(c),e=h.Pos(c.line,d.start);d.start<c.ch&&/\w/.test(d.string.charAt(c.ch-d.start-1))?d=d.string.substr(0,c.ch-d.start):(d="",e=c);for(var m=[],f=0;f<b.words.length;f++){var r=b.words[f];r.slice(0,d.length)==d&&m.push(r)}if(m.length)return{list:m,from:e,to:c}});h.commands.autocomplete=h.showHint;var I={hint:h.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnPick:!0,
closeOnUnfocus:!0,updateOnCursorActivity:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null,paddingForScrollbar:!0,moveOnOverlap:!0};h.defineOption("hintOptions",null)});